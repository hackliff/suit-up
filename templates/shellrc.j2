# --
# -- {{ ansible_managed }}
# --

# environment configuration
test -d {{ dna_bin_path }} && export PATH=$PATH:{{ dna_bin_path }}
test -d {{ consul_home }}/bin && export PATH=$PATH:{{ consul_home }}/bin

# third party utilities
[[ -f {{ dna_lib_path }}/k.sh ]] && source {{ dna_lib_path }}/k.sh
[[ -f {{ dna_lib_path }}/z.sh ]] && source {{ dna_lib_path }}/z.sh
[[ -f {{ dna_lib_path }}/autoenv/activate.sh ]] && source {{ dna_lib_path }}/autoenv/activate.sh

## pyenv
export PYENV_ROOT={{ dna_lib_path }}/pyenv eval
export PATH=$PATH:$PYENV_ROOT/bin
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
source {{ dna_lib_path }}/pyenv/completions/pyenv.zsh
pyenv global {{ dev.python_version}} || pyenv install {{ dev.python_version }}

## install and/or activate node
n {{ dev.node_version }}

dstart() {
  local MACHINE_NAME="${1:-{{ docker_vm_name }}}"
  docker-machine start ${MACHINE_NAME} && eval "$(docker-machine env ${MACHINE_NAME})"
}

dhack () {
  local name=${1:-lab}
  local container="$(basename $PWD)_${name}_1"
  dstart
  docker-compose up -d
  docker exec -it ${container} bash
}
